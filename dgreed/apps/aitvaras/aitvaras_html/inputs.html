
<html>
	<head>
        <!--<meta name="viewport" content="width=device-width, user-scalable=no" />-->
		<title>aitvaras</title>
		<link href="style.css" rel="stylesheet" type="text/css" />
        <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.1.0-rc.1/jquery.mobile-1.1.0-rc.1.min.js"></script>
		<script src="processing-1.3.6.min.js"></script>
		<script type="application/javascript">
			function getUrlVars() {
				var vars = {};
				var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
					vars[key] = value;
				});
				return vars;
			}

			var vars = getUrlVars();

			function join() {
				var req = new XMLHttpRequest();
				req.onreadystatechange = function() {
					if(req.readyState == 4 && req.status == 200) {
						console.log("sucess!");
						vars.client_id = req.responseText;
					}
				}
				req.open("GET", vars.server + "/join", true);
				req.send();
			}

			function leave() {
				console.log("leave!");
				var req = new XMLHttpRequest();
				req.open("POST", vars.server + "/leave", true);
				req.send(vars.client_id);
			}

			function move(dir, up) {
				var req = new XMLHttpRequest();
				req.open("POST", vars.server + "/input", true);
				req.send(vars.client_id + ":" + dir + ":" + up);
			}

			join();
			window.onbeforeunload = leave;
            
            //here starts virtual mouse events
			$(function(){
    			$(".bup").bind("vmousedown", function(){
        			move("u", "d");
    			});
                $(".bleft").bind("vmousedown", function(){
        			move("l", "d");
    			});
                $(".bright").bind("vmousedown", function(){
        			move("r", "d");
    			});
                $(".bdown").bind("vmousedown", function(){
        			move("d", "d");
    			});
                //virtual mouse release
                $(".bup").bind("vmouseup", function(){
        			move("u", "u");
    			});
                $(".bleft").bind("vmouseup", function(){
        			move("l", "u");
    			});
                $(".bright").bind("vmouseup", function(){
        			move("r", "u");
    			});
                $(".bdown").bind("vmouseup", function(){
        			move("d", "u");
    			});
			});
		</script>
	</head>
	<body>
		<button class="bup"></button>
		<button class="bleft"></button>
		<button class="bright"></button>
		<button class="bdown"></button>
	</body>
</html>