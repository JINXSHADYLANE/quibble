<html>
	<head>
		<title>aitvaras</title>
		<link href="style.css" rel="stylesheet" type="text/css" />
		<script src="processing-1.3.6.min.js"></script>
		<script type="application/javascript">
			function getUrlVars() {
				var vars = {};
				var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
					vars[key] = value;
				});
				return vars;
			}

			var vars = getUrlVars();

			function join() {
				var req = new XMLHttpRequest();
				req.onreadystatechange = function() {
					if(req.readyState == 4 && req.status == 200) {
						console.log("sucess!");
						vars.client_id = req.responseText;
					}
				}
				req.open("GET", vars.server + "/join", true);
				req.send();
			}

			function leave() {
				console.log("leave!");
				var req = new XMLHttpRequest();
				req.open("POST", vars.server + "/leave", true);
				req.send(vars.client_id);
			}

			function move(dir, up) {
				var req = new XMLHttpRequest();
				req.open("POST", vars.server + "/input", true);
				req.send(vars.client_id + ":" + dir + ":" + up);
			}

			join();
			window.onbeforeunload = leave;
		</script>
	</head>
	<body>
		<button class="bup"    onmousedown="move('u', 'd');" onmouseup="move('u', 'u');"></button>
		<button class="bleft"  onmousedown="move('l', 'd');" onmouseup="move('l', 'u');"></button>
		<button class="bright" onmousedown="move('r', 'd');" onmouseup="move('r', 'u');"></button>
		<button class="bdown"  onmousedown="move('d', 'd');" onmouseup="move('d', 'u');"></button>
	</body>
</html>